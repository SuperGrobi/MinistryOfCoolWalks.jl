<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Hexagonal Binning · MinistryOfCoolWalks.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://SuperGrobi.github.io/MinistryOfCoolWalks.jl/HexagonalBins/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">MinistryOfCoolWalks.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../CenterlineCorrection/">Centerline correction</a></li><li><a class="tocitem" href="../ShadowIntersection/">Shadow intersections</a></li><li><a class="tocitem" href="../Routing/">Routing</a></li><li><a class="tocitem" href="../RoutingMeasures/">Routing based Measures</a></li><li class="is-active"><a class="tocitem" href>Hexagonal Binning</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#API"><span>API</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Hexagonal Binning</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Hexagonal Binning</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SuperGrobi/MinistryOfCoolWalks.jl/blob/main/docs/src/HexagonalBins.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Hexagonal-Bins"><a class="docs-heading-anchor" href="#Hexagonal-Bins">Hexagonal Bins</a><a id="Hexagonal-Bins-1"></a><a class="docs-heading-anchor-permalink" href="#Hexagonal-Bins" title="Permalink"></a></h1><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>These utilities can be used to aggregate arbitrary spatial properties into hexagonal areas. Might be useful. Note that these functions are lacking tests.</p><h2 id="API"><a class="docs-heading-anchor" href="#API">API</a><a id="API-1"></a><a class="docs-heading-anchor-permalink" href="#API" title="Permalink"></a></h2><ul><li><a href="#MinistryOfCoolWalks.get_crs_for_hexagons-Tuple{DataFrames.DataFrame}"><code>MinistryOfCoolWalks.get_crs_for_hexagons</code></a></li><li><a href="#MinistryOfCoolWalks.hex_center-Tuple{Hexagons.Hexagon, Any}"><code>MinistryOfCoolWalks.hex_center</code></a></li><li><a href="#MinistryOfCoolWalks.hexagon_area-Tuple{Any, Any}"><code>MinistryOfCoolWalks.hexagon_area</code></a></li><li><a href="#MinistryOfCoolWalks.hexagon_histogram-Tuple{Any, Any, Any}"><code>MinistryOfCoolWalks.hexagon_histogram</code></a></li><li><a href="#MinistryOfCoolWalks.hexagonify-Tuple{Any, Any}"><code>MinistryOfCoolWalks.hexagonify</code></a></li><li><a href="#MinistryOfCoolWalks.hexes2polys-Tuple{Any, Any}"><code>MinistryOfCoolWalks.hexes2polys</code></a></li><li><a href="#MinistryOfCoolWalks.hexgrid_buffer-Tuple{Any}"><code>MinistryOfCoolWalks.hexgrid_buffer</code></a></li></ul><article class="docstring"><header><a class="docstring-binding" id="MinistryOfCoolWalks.get_crs_for_hexagons-Tuple{DataFrames.DataFrame}" href="#MinistryOfCoolWalks.get_crs_for_hexagons-Tuple{DataFrames.DataFrame}"><code>MinistryOfCoolWalks.get_crs_for_hexagons</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">get_crs_for_hexagons(df::DataFrame)
get_crs_for_hexagons(g::AbstractMetaGraph)</code></pre><p>unified interface for accessing the local coordinate system of dataframes and graphs that support it.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SuperGrobi/MinistryOfCoolWalks.jl/blob/60443105ec196ba26d4981aa157368c7415c7107/src/HexagonalBins.jl#L126-L131">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MinistryOfCoolWalks.hex_center-Tuple{Hexagons.Hexagon, Any}" href="#MinistryOfCoolWalks.hex_center-Tuple{Hexagons.Hexagon, Any}"><code>MinistryOfCoolWalks.hex_center</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">hex_center(hex::Hexagons.Hexagon, r)</code></pre><p>caculates the centerpoint of the <code>hex</code> with radius <code>r</code>. Returns an <code>ArchGDAL</code> point.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SuperGrobi/MinistryOfCoolWalks.jl/blob/60443105ec196ba26d4981aa157368c7415c7107/src/HexagonalBins.jl#L8-L12">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MinistryOfCoolWalks.hexagon_area-Tuple{Any, Any}" href="#MinistryOfCoolWalks.hexagon_area-Tuple{Any, Any}"><code>MinistryOfCoolWalks.hexagon_area</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">hexagon_area(dx, dy)</code></pre><p>area of a hexagon with radius 1, that is scaled by <code>dx</code> in x direction, and by <code>dy</code> in y direction.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SuperGrobi/MinistryOfCoolWalks.jl/blob/60443105ec196ba26d4981aa157368c7415c7107/src/HexagonalBins.jl#L1-L5">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MinistryOfCoolWalks.hexagon_histogram-Tuple{Any, Any, Any}" href="#MinistryOfCoolWalks.hexagon_histogram-Tuple{Any, Any, Any}"><code>MinistryOfCoolWalks.hexagon_histogram</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">hexagon_histogram(aggregator, geom_source, radius; buffer=0, danger_value=10000, filter_values=x -&gt; true)</code></pre><p>calculates the &quot;generalised histogram&quot; for data in a <code>DataFrame</code> or <code>MetaGraph</code>. For both these types, we expect the following methods to be implemented:</p><ul><li><code>project_local!</code></li><li><code>build_rtree</code> (<code>val</code> should be a <code>NamedTuple</code> with at least the <code>ArchGDAL.IGeometry</code> under the keyword of <code>orig</code>).</li><li><code>hexagonify</code></li><li><code>get_crs_for_hexagons</code></li><li><code>project_back!</code></li></ul><p><strong>Arguments</strong></p><ul><li><code>aggregator</code>: closure <code>(actual_intersections::Vector{SpatialElem}, hexagon::ArchGDAL.IGemometry{WKBPolygon})-&gt;T</code>, where <code>T</code> is the type of result in each hexagon-bin.   the first Argument is a Vector of the <code>SpatialElem</code>ents in the R-Tree of <code>geom_source</code>, where <code>ArchGDAL.intersects(hexagon, intersection.val.orig)==true</code>. The second   argument is the hexagon which is currently aggregated over.</li><li><code>geom_source</code>: source of geometry for R-Tree (and maybe other data.), currently, <code>DataFrame</code> and <code>AbstractMetaGraph</code> are supported.</li><li><code>radius</code>: radius of hexagons in which the bins should be calculated. (Passed to <code>hexagonify</code>).</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>buffer=0</code>: Number of times the hexagons should be buffered before the aggregation.</li><li><code>danger_value=10000</code>: Number of predicted hexes above which <code>hexagonify</code> will fail.</li><li><code>filter_values=x-&gt;true</code>: Only hexagons where the <code>filter_values(aggregation_value)==true</code> will be returned.</li></ul><p><strong>Process</strong></p><p>We project <code>geom_source</code> to a local coordinate system and calculate the hexagonalisation of the area defined by it. The projected <code>geom_source</code> is then converted into an <code>R-Tree</code>. For each hexagon in the hexagonalisation we calculate the value within that hexagon using the <code>aggregator</code>, filter these <code>values</code> with <code>filter_values</code>, project everything back, and return only the hexagons and <code>values</code> where <code>filter_values(value)==true</code>.</p><p>Returns <code>(filtered_hexagons, filtered_values)</code></p><p><strong>Examples</strong></p><p>To get the number of nodes of a <code>ShadowGraph</code> in each hexagon with more than 0 nodes, you can do something like this:</p><pre><code class="language-julia hljs">hexes, values = hexagon_histogram(shadow_graph, 50; filter_values=(&gt;(0))) inters, hex
    count(i -&gt; i.val.type == :vertex, inters)
end</code></pre><p>To get the total area of (possibly overlapping) buildings do:</p><pre><code class="language-julia hljs">hexes, values = hexagon_histogram(buildings, 50) do inters, hex
    geom = mapreduce(ArchGDAL.union, inters; init=ArchGDAL.createpolygon()) do i
        ArchGDAL.intersection(hex, i.val.orig)
    end
    return ArchGDAL.geomarea(geom)
end</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SuperGrobi/MinistryOfCoolWalks.jl/blob/60443105ec196ba26d4981aa157368c7415c7107/src/HexagonalBins.jl#L135-L182">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MinistryOfCoolWalks.hexagonify-Tuple{Any, Any}" href="#MinistryOfCoolWalks.hexagonify-Tuple{Any, Any}"><code>MinistryOfCoolWalks.hexagonify</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">hexagonify(geometries, hex_radius; kwargs...)
hexagonify(df::DataFrame, hex_radius; kwargs...) = hexagonify(df.geometry, hex_radius; kwargs...)
hexagonify(g::AbstractMetaGraph, hex_radius; kwargs...)
hexagonify(polygon::ArchGDAL.IGeometry, hex_radius; buffer=0, danger_value=10000)</code></pre><p>puts a bunch of hexagons with radius <code>hex_radius</code> in the area given by:</p><ul><li>the convex hull of a vector of <code>geometries</code>.</li><li>the convex hull of the colum titled <code>:geometry</code> of a dataframe <code>df</code>.</li><li>the convex hull of the <code>:sg_geometry</code> prop in the vertices of (<code>g</code>).</li><li>a <code>polygon</code>.</li></ul><p>All these things are expected to be ArchGDAL geometries.</p><p>A hexagon will be placed, if its centerpoint is within the polygon.</p><p><strong>keyword arguments</strong></p><ul><li><code>buffer</code>=0, number of times the resulting hex-grid should be buffered (that is, a layer of hexagons added to the outside) after filling the geometry.</li><li><code>danger_value=10000</code> if the approximated number of hexagons is larger than this value, we will throw an assertion error. This is to keep you from accidentally killing your REPL if you forget to convert between local and global corrdinate systems.</li></ul><p>Returns a Vector of <code>Hexagons.HexagonCubic</code>s.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SuperGrobi/MinistryOfCoolWalks.jl/blob/60443105ec196ba26d4981aa157368c7415c7107/src/HexagonalBins.jl#L15-L36">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MinistryOfCoolWalks.hexes2polys-Tuple{Any, Any}" href="#MinistryOfCoolWalks.hexes2polys-Tuple{Any, Any}"><code>MinistryOfCoolWalks.hexes2polys</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">hexes2polys(hexes, hex_radius)</code></pre><p>converts a vector of <code>Hexangons.Hexagon</code> with radius <code>hex_radius</code> to a vector of <code>ArchGDAL</code> polygons.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SuperGrobi/MinistryOfCoolWalks.jl/blob/60443105ec196ba26d4981aa157368c7415c7107/src/HexagonalBins.jl#L114-L118">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="MinistryOfCoolWalks.hexgrid_buffer-Tuple{Any}" href="#MinistryOfCoolWalks.hexgrid_buffer-Tuple{Any}"><code>MinistryOfCoolWalks.hexgrid_buffer</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">hexgrid_buffer(hexes)</code></pre><p>returns a vector of all hexagons that touch at least one hexagon in <code>hexes</code>, without duplicates.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SuperGrobi/MinistryOfCoolWalks.jl/blob/60443105ec196ba26d4981aa157368c7415c7107/src/HexagonalBins.jl#L96-L100">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../RoutingMeasures/">« Routing based Measures</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Friday 25 August 2023 08:50">Friday 25 August 2023</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
